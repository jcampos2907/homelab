alloy:
  # DaemonSet is fine; each node tails its pods via the API
  mounts:
    varlog: false

  configMap:
    create: true
    content: |-
      // --- Discover pods
      discovery.kubernetes "pods" {
        role = "pod"
      }

      // --- Read pod logs from the K8s API and push directly to Loki
      loki.source.kubernetes "pods" {
        targets    = discovery.kubernetes.pods.targets
        forward_to = [loki.write.to_loki.receiver]
      }

      // --- Loki write target (matches your Grafana datasource tenant + URL)
      loki.write "to_loki" {
        endpoint {
          url = "http://loki-gateway.monitoring.svc.cluster.local/loki/api/v1/push"
          headers = { "X-Scope-OrgID" = "fake" }
        }
      }

controller:
  type: daemonset

rbac:
  create: true
