agent:
  enabled: true
  namespace: jenkins
  customJenkinsLabels:
    - "k8s-agent"

controller:
  # URL Jenkins advertises to plugins and OIDC
  jenkinsUrl: "https://jenkins.famcr.org"

  # Local admin for escape hatch & API tokens
  admin:
    password: "adminpassword123"   # consider replacing with a secret or disable later

  ingress:
    enabled: false

  # Important: ensure persistence so config.xml + JCasC survive restarts
  persistence:
    enabled: true
    size: 10Gi
    storageClass: longhorn  # or whatever storage you're using

  # Disable Helmâ€™s default JCasC to prevent overriding OIDC on restart
  JCasC:
    defaultConfig: true
    configScripts:
      security-realm: |-
        jenkins:
          securityRealm:
            oic:
              serverConfiguration:
                wellKnown:
                  wellKnownOpenIDConfigurationUrl: "https://keycloak.famcr.org/realms/master/.well-known/openid-configuration"
                  scopesOverride: "openid profile email"

              clientId: "jenkins"
              clientSecret: "${OIC_CLIENT_SECRET}"

              userNameField: "preferred_username"
              fullNameFieldName: "name"
              emailFieldName: "email"
              groupsFieldName: "groups"

              logoutFromOpenidProvider: false

      # Example: minimal authorization strategy (allow logged-in users)
      # authorization: |-
      #   jenkins:
      #     authorizationStrategy:
      #       loggedInUsersCanDoAnything:
      #         allowAnonymousRead: false

  # Provide environment variables for JCasC secrets
  env:
    - name: OIC_CLIENT_SECRET
      valueFrom:
        secretKeyRef:
          name: jenkins-oidc
          key: clientSecret

    - name: JENKINS_ESCAPE_USER
      valueFrom:
        secretKeyRef:
          name: jenkins-oidc
          key: escapeUser

    - name: JENKINS_ESCAPE_PASS
      valueFrom:
        secretKeyRef:
          name: jenkins-oidc
          key: escapePass