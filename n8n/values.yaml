main:
  extraEnv:
    - name: N8N_PROXY_HOPS
      value: "1"
    # - name: N8N_HOST
    #   value: "n8n.famcr.org"
    - name: N8N_EDITOR_BASE_URL
      value: "https://n8n.famcr.org/"
    - name: N8N_PORT
      value: "5678"
    # - name: N8N_PROTOCOL
    #   value: "https"
    - name: N8N_ENDPOINT_REST
      value: "rest"
    # - name: N8N_ENDPOINT_WEBHOOK
    #   value: "webhook"
    # - name: N8N_ENDPOINT_WEBHOOK_TEST
    #   value: "webhook-test"
    - name: N8N_WEBHOOK_TUNNEL_URL
      value: "https://n8n.famcr.org/"
    - name: WEBHOOK_URL
      value: "https://n8n.famcr.org/"
    - name: DB_POSTGRESDB_USER
      valueFrom:
        secretKeyRef:
          name: n8n-user
          key: username
    - name: N8N_ENCRYPTION_KEY
      valueFrom:
        secretKeyRef:
          name: n8n-encryption-key
          key: encryption_key
    - name: DB_POSTGRESDB_PASSWORD
      valueFrom:
        secretKeyRef:
          name: n8n-user
          key: password
    - name: QUEUE_BULL_REDIS_PASSWORD
      valueFrom:
        secretKeyRef:
          name: n8n-redis-auth
          key: redis-password
  config:
    executions:
      mode: "queue"
    queue:
      bull:
        redis:
          host: "redis.redis.svc.cluster.local"
          port: 6379
    db:
      type: "postgresdb"
      postgresdb:
        host: "homelabcluster-rw.homelab-pg.svc.cluster.local"
        port: 5432
        database: "n8n"
  persistence:
    enabled: true
    type: dynamic
    size: 10Gi
    storageClass: "longhorn"
  # extraEnv:
  #   - name: VUE_APP_URL_BASE_API
  #     value: "n8n.famcr.org"
ingress:
  enabled: true
  className: "traefik"

  hosts:
    - host: n8n.famcr.org
      paths:
        - path: /
          pathType: Prefix
  tls:
    - hosts:
        - n8n.famcr.org
      secretName: n8n-certificate-secret

worker:
  enabled: true
  replicaCount: 1
  concurrency: 5
  persistence:
    enabled: true
    type: existing
    existingClaim: n8n-worker
  extraEnv:
    - name: N8N_PORT
      value: "5678"
    - name: QUEUE_BULL_REDIS_PASSWORD
      valueFrom:
        secretKeyRef:
          name: n8n-redis-auth
          key: redis-password
    - name: DB_POSTGRESDB_USER
      valueFrom:
        secretKeyRef:
          name: n8n-user
          key: username
    - name: DB_POSTGRESDB_PASSWORD
      valueFrom:
        secretKeyRef:
          name: n8n-user
          key: password
    - name: N8N_ENCRYPTION_KEY
      valueFrom:
        secretKeyRef:
          name: n8n-encryption-key
          key: encryption_key
